---
import List from "./taskList.astro";
import BoardHeader from "../boardHeader.astro";
import { serverURL } from "../../pages/conf";
import Sidebar from "../boardSidebar.astro";

const url = Astro.url;
let sessionId = Astro.cookies.get('sessionId').value;

const response = await fetch(`${serverURL}/boards/boards/get`, {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json'
    },
    body: JSON.stringify({ sessionId: sessionId, boardId: 1 })
});

const { data: boards } = await response.json();

// Get board ID from URL parameter
const boardIdParam = url.searchParams.get('boardId');
const allBoards = boards.flat();

// Find selected board
let selectedBoardId = allBoards[0]?.boardID; // Default to first board
if (boardIdParam) {
    const parsedId = parseInt(boardIdParam);
    const exists = allBoards.some(board => board.boardID === parsedId);
    selectedBoardId = exists ? parsedId : selectedBoardId;
}

const selectedBoard = allBoards.find(board => board.boardID === selectedBoardId);
const boardName = selectedBoard?.boardName || 'Default Board Name';
---
<BoardHeader {boards}></BoardHeader>
<div class="board-content">
    <div class="board-list-view">
        <ul class="board-header">
            <li><h1>{boardName}</h1></li>
            <div class="toggle-container">
                <button
                        :class="{ 'toggle-button': true, 'active': showProjectBoard }"
                        @click="showProjectBoard = false"
                >
                    Show Project Board
                </button>
            </div>
        </ul>
        <div>
            <List boardId={selectedBoardId}></List>
        </div>
    </div>
    <Sidebar></Sidebar>
</div>